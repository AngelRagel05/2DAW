<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lista Empleados</title>
  </head>
  <body>
    <h1>Añadir Empleado</h1>
    <form id="formEmpleado">
      <label for="nombre">Nombre:</label>
      <input type="text" id="nombre" name="nombre" required />
      <br />

      <label for="puesto">Puesto:</label>
      <input type="text" id="puesto" name="puesto" required />
      <br />

      <label for="salario">Salario:</label>
      <input type="number" id="salario" name="salario" required />
      <br />

      <button type="submit">Añadir Empleado</button>
    </form>

    <hr />

    <h1>Nuestros Empleados</h1>
    <ul id="listaEmpleados"></ul>

    <button id="recargar">Recarga la lista de Empleados</button>

    <script>
      function cargarEmpleados() {
        fetch("api.php?recurso=empleados")
          .then((response) => response.json())
          .then((empleados) => {
            const lista = document.getElementById("listaEmpleados");
            lista.innerHTML = "";

            empleados.forEach((empleado) => {
              const li = document.createElement("li");
              li.textContent = `${empleado.nombre} - ${empleado.puesto} - ${empleado.salario}€`;
              lista.appendChild(li);
            });
          })
          .catch((error) => {
            console.error("Error al obtener los empleados:", error);
          });
      }

      cargarEmpleados();

      const form = document.getElementById("formEmpleado");

      form.addEventListener("submit", (event) => {
        event.preventDefault();

        const datos = {
          nombre: document.getElementById("nombre").value,
          puesto: document.getElementById("puesto").value,
          salario: document.getElementById("salario").value,
        };

        fetch("api.php?recurso=empleados", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(datos),
        })
          .then((response) => response.json())
          .then((resultado) => {
            alert("Empleado añadido correctamente");

            cargarEmpleados();
            form.reset();
          }).catch((error) => {
            console.error("Error al añadir el empleado:", error);
          });
      });

      document
        .getElementById("recargar")
        .addEventListener("click", cargarEmpleados);
    </script>
  </body>
</html>
